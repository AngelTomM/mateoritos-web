<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta charset="utf-8" />
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="style.css" />
    <!-- Styles for the long informational section from new/ -->
    <link rel="stylesheet" href="new/style_new2.css" />
    <style>
      /* Make sure html/body occupy full height and reset margins */
      html, body { height: 100%; margin: 0; padding: 0; }
      /* Use a fixed pseudo-element to render the background so it never scrolls */
      body.sim-page { position: relative; }
      body.sim-page::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image: url('FondoEspacio.png');
        background-size: cover;
        background-position: center center;
        background-repeat: no-repeat;
        transform: translateZ(0);
        will-change: transform;
        z-index: 0;
        pointer-events: none;
      }
      /* Ensure the visible UI sits above the fixed background and add spacing for the info section */
      .ventana { position: relative; z-index: 1; }
      .rectangle-2 { z-index: 2; }
      .space-page-content { margin-top: 48px; padding: 32px 20px 80px; position: relative; z-index: 3; }
    </style>
  </head>
  <body class="sim-page">
    <div class="ventana">
      <div class="rectangle"></div>
      <p class="SIMULACION-DE">SIMULACION DE TRAYECTORIAS: <br />COMPORTAMIENTO ORBITAL DE ASTEROIDES</p>
      <div class="div" id="left-panel">
        <div class="left-content" style="position:relative;padding:20px;display:flex;flex-direction:column;gap:12px;">
          <!-- Slides moved here -->
          <div id="slides-panel" style="display:flex;flex-direction:column;gap:8px;">
            <div style="display:flex;gap:6px;align-items:center;">
              <button class="slide-btn" data-preset="1">Asteroide 1</button>
              <button class="save-btn" data-preset="1" title="Guardar parÃ¡metros">ðŸ’¾</button>
            </div>
            <div style="display:flex;gap:6px;align-items:center;">
              <button class="slide-btn" data-preset="2">Asteroide 2</button>
              <button class="save-btn" data-preset="2" title="Guardar parÃ¡metros">ðŸ’¾</button>
            </div>
            <div style="display:flex;gap:6px;align-items:center;">
              <button class="slide-btn" data-preset="3">Asteroide 3</button>
              <button class="save-btn" data-preset="3" title="Guardar parÃ¡metros">ðŸ’¾</button>
            </div>
          </div>
          <div style="margin-top:6px;">
            <button id="reset-presets" style="padding:8px 10px;border-radius:6px;border:none;background:#444;color:#fff;cursor:pointer;">Restaurar presets por defecto</button>
          </div>
          <!-- Controls: native HTML ranges to replace p5 sliders -->
          <div id="controls" style="display:flex;flex-direction:column;gap:8px; margin-top:8px;">
            <label style="color:white; font-weight:700; display:flex; align-items:center; gap:8px;">a (UA)
              <input id="a-range" type="range" min="0.00001" max="1.6" step="0.000001" value="1.6" style="width:100%;">
              <span id="a-val" style="min-width:70px;text-align:right;color:#fff;font-weight:700;">1.600000</span>
            </label>
            <label style="color:white; font-weight:700; display:flex; align-items:center; gap:8px;">e (excentricidad)
              <input id="e-range" type="range" min="0" max="0.99" step="0.001" value="0.8611" style="width:100%;">
              <span id="e-val" style="min-width:60px;text-align:right;color:#fff;font-weight:700;">0.861</span>
            </label>
            <label style="color:white; font-weight:700; display:flex; align-items:center; gap:8px;">i (Â°)
              <input id="i-range" type="range" min="0" max="45" step="0.01" value="4.10" style="width:100%;">
              <span id="i-val" style="min-width:50px;text-align:right;color:#fff;font-weight:700;">4.10</span>
            </label>
          </div>
          <!-- Info values (populated by the sketch) -->
          <div id="info-values"></div>
          <!-- Danger banner will be placed below the slides/info by the sketch -->
          <div id="peligro-div"></div>
          <a href="index.html" class="back-btn" style="margin-top:12px;display:inline-block;text-decoration:none;">
            <button style="padding:10px 14px;border-radius:8px;border:none;background:#fc3d21;color:white;cursor:pointer;">Volver al inicio</button>
          </a>
        </div>
      </div>
      <div class="rectangle-2">
        <!-- Container where the p5 canvas will be placed so the simulation appears inside this right card -->
        <div id="simulacion-container" style="width:100%;height:100%;position:relative;"></div>
      </div>
    </div>

    <!-- Load p5 library from CDN first, then load the actual sketch (sketch.js) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.11.10/p5.min.js"></script>
    <script>
      // expose a global currentSlide and wire up the slide buttons (now in left panel)
      window.currentSlide = 1;
      document.addEventListener('DOMContentLoaded', () => {
        const panel = document.getElementById('slides-panel');
        if (!panel) return;
        // preset mapping (will be loaded from localStorage if present)
        const DEFAULT_PRESETS = {
          1: { a: 0.01, e: 0.2, i: 2.5 },
          2: { a: 0.005, e: 0.7, i: 10.0 },
          3: { a: 0.002, e: 0.86, i: 4.1 }
        };

        function loadPresets() {
          try {
            const raw = localStorage.getItem('mateoritos_presets_v1');
            if (!raw) return Object.assign({}, DEFAULT_PRESETS);
            const parsed = JSON.parse(raw);
            // ensure keys 1..3 exist
            return Object.assign({}, DEFAULT_PRESETS, parsed);
          } catch (e) {
            console.warn('Failed to load presets from localStorage', e);
            return Object.assign({}, DEFAULT_PRESETS);
          }
        }

        function savePresets(presets) {
          try {
            localStorage.setItem('mateoritos_presets_v1', JSON.stringify(presets));
            return true;
          } catch (e) {
            console.warn('Failed to save presets to localStorage', e);
            return false;
          }
        }

        let presets = loadPresets();

        panel.querySelectorAll('.slide-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const p = Number(btn.getAttribute('data-preset')) || 1;
            const preset = presets[p] || presets[1];
            // apply to ranges
            const aRange = document.getElementById('a-range');
            const eRange = document.getElementById('e-range');
            const iRange = document.getElementById('i-range');
            if (aRange) { aRange.value = preset.a; aRange.dispatchEvent(new Event('input')); }
            if (eRange) { eRange.value = preset.e; eRange.dispatchEvent(new Event('input')); }
            if (iRange) { iRange.value = preset.i; iRange.dispatchEvent(new Event('input')); }
            // visual feedback
            panel.querySelectorAll('.slide-btn').forEach(b => b.style.opacity = '0.6');
            btn.style.opacity = '1';
          });
        });
        // wire up the save buttons so users can store the current ranges into the preset slot
        panel.querySelectorAll('.save-btn').forEach(saveBtn => {
          saveBtn.addEventListener('click', () => {
            const p = Number(saveBtn.getAttribute('data-preset')) || 1;
            const aRange = document.getElementById('a-range');
            const eRange = document.getElementById('e-range');
            const iRange = document.getElementById('i-range');
            if (!aRange || !eRange || !iRange) return;
            presets[p] = { a: parseFloat(aRange.value), e: parseFloat(eRange.value), i: parseFloat(iRange.value) };
            const ok = savePresets(presets);
            // tiny UI feedback: flash the button background briefly
            const orig = saveBtn.style.background;
            if (ok) {
              saveBtn.style.background = '#28a745';
              saveBtn.textContent = 'âœ“';
            } else {
              saveBtn.style.background = '#dc3545';
              saveBtn.textContent = 'âœ•';
            }
            setTimeout(() => {
              saveBtn.style.background = orig;
              saveBtn.textContent = 'ðŸ’¾';
            }, 800);
          });
        });
        // set initial opacity
        panel.querySelectorAll('.slide-btn').forEach(b => b.style.opacity = '0.6');
        const first = panel.querySelector('.slide-btn[data-preset="1"]');
        if (first) first.style.opacity = '1';

        // reset button: restore DEFAULT_PRESETS into storage and apply default values to ranges
        const resetBtn = document.getElementById('reset-presets');
        if (resetBtn) {
          resetBtn.addEventListener('click', () => {
            presets = Object.assign({}, DEFAULT_PRESETS);
            const ok = savePresets(presets);
            // apply preset 1 values to the ranges so user sees the reset
            const aRange = document.getElementById('a-range');
            const eRange = document.getElementById('e-range');
            const iRange = document.getElementById('i-range');
            const p = presets[1] || DEFAULT_PRESETS[1];
            if (aRange) { aRange.value = p.a; aRange.dispatchEvent(new Event('input')); }
            if (eRange) { eRange.value = p.e; eRange.dispatchEvent(new Event('input')); }
            if (iRange) { iRange.value = p.i; iRange.dispatchEvent(new Event('input')); }
            // visual feedback
            const origBg = resetBtn.style.background;
            const origText = resetBtn.textContent;
            if (ok) {
              resetBtn.style.background = '#28a745';
              resetBtn.textContent = 'Restaurado âœ“';
            } else {
              resetBtn.style.background = '#dc3545';
              resetBtn.textContent = 'Error';
            }
            setTimeout(() => {
              resetBtn.style.background = origBg;
              resetBtn.textContent = origText;
            }, 1200);
            // set first preset visual active
            panel.querySelectorAll('.slide-btn').forEach(b => b.style.opacity = '0.6');
            if (first) first.style.opacity = '1';
          });
        }
      });
    </script>
    <script src="sketch.js"></script>
    <script>
      // live value update for ranges
      document.addEventListener('DOMContentLoaded', () => {
        const aRange = document.getElementById('a-range');
        const eRange = document.getElementById('e-range');
        const iRange = document.getElementById('i-range');
        const aVal = document.getElementById('a-val');
        const eVal = document.getElementById('e-val');
        const iVal = document.getElementById('i-val');
        function updateA() { if (aVal && aRange) aVal.textContent = parseFloat(aRange.value).toFixed(6); }
        function updateE() { if (eVal && eRange) eVal.textContent = parseFloat(eRange.value).toFixed(3); }
        function updateI() { if (iVal && iRange) iVal.textContent = parseFloat(iRange.value).toFixed(2); }
        if (aRange) aRange.addEventListener('input', updateA); updateA();
        if (eRange) eRange.addEventListener('input', updateE); updateE();
        if (iRange) iRange.addEventListener('input', updateI); updateI();
      });
    </script>
    <script>
      // i18n: extend language toggle to this page by reading localStorage 'mateoritos_lang'
      (function(){
        const texts = {
          es: {
            title: 'SIMULACION DE TRAYECTORIAS: <br />COMPORTAMIENTO ORBITAL DE ASTEROIDES',
            slide1: 'Asteroide 1',
            slide2: 'Asteroide 2',
            slide3: 'Asteroide 3',
            save_title: 'Guardar parÃ¡metros',
            reset: 'Restaurar presets por defecto',
            a_label: 'a (UA)',
            e_label: 'e (excentricidad)',
            i_label: 'i (Â°)',
            back: 'Volver al inicio',
            recommendation_h2: 'RecomendaciÃ³n:',
            recommendation_p: 'Simule la trayectoria de los asteroides a continuaciÃ³n para visualizar su trayectoria.',
            params_h1: 'ParÃ¡metros de asteroides PHA de la NASA',
            table: [
              'Asteroide','H=Brillo','a=Semieje Mayor (UA)','q=Perihelio (UA)','Q=Afelio (UA)','e=Excentricidad','i=InclinaciÃ³n Orbital con respecto a la eclÃ­ptica (Â°)','moid=Distancia MÃ­nima de IntersecciÃ³n Orbital con la Tierra (UA)','PerÃ­odo (aÃ±os)'
            ],
            nasa_criteria_p: 'La NASA considera como asteroides <strong>PHA (Potencialmente Hazardous Asteroids)</strong> cuando cumplen:',
            formulas_h2: 'FÃ³rmulas que determinan los parÃ¡metros mencionados:',
            formula_kepler: 'Kepler',
            formula_velocity: 'Velocidad del asteroide',
            formula_distance: 'Distancia con el planeta Tierra'
          },
          en: {
            title: 'TRAJECTORY SIMULATION: <br />ORBITAL BEHAVIOR OF ASTEROIDS',
            slide1: 'Asteroid 1',
            slide2: 'Asteroid 2',
            slide3: 'Asteroid 3',
            save_title: 'Save parameters',
            reset: 'Restore default presets',
            a_label: 'a (AU)',
            e_label: 'e (eccentricity)',
            i_label: 'i (Â°)',
            back: 'Back to home',
            recommendation_h2: 'Recommendation:',
            recommendation_p: 'Simulate the asteroids trajectory below to visualize their paths.',
            params_h1: "PHA asteroid parameters from NASA",
            table: [
              'Asteroid','H=Absolute magnitude','a=Semi-major axis (AU)','q=Perihelion (AU)','Q=Aphelion (AU)','e=Eccentricity','i=Orbital inclination to the ecliptic (Â°)','moid=Minimum Orbit Intersection Distance with Earth (AU)','Period (years)'
            ],
            nasa_criteria_p: 'NASA considers asteroids <strong>PHA (Potentially Hazardous Asteroids)</strong> when they meet:',
            formulas_h2: 'Formulas that determine the mentioned parameters:',
            formula_kepler: 'Kepler',
            formula_velocity: 'Asteroid velocity',
            formula_distance: 'Distance to planet Earth'
          }
        };

        function applyLang(lang){
          const t = texts[lang] || texts.es;
          // Title
          const title = document.querySelector('.SIMULACION-DE'); if (title) title.innerHTML = t.title;
          // Slide buttons
          const slides = document.querySelectorAll('#slides-panel .slide-btn');
          if (slides && slides.length >= 3) {
            slides[0].textContent = t.slide1;
            slides[1].textContent = t.slide2;
            slides[2].textContent = t.slide3;
          }
          // Save buttons title
          document.querySelectorAll('#slides-panel .save-btn').forEach(b => { b.title = t.save_title; });
          // Reset button
          const resetBtn = document.getElementById('reset-presets'); if (resetBtn) resetBtn.textContent = t.reset;
          // Labels for ranges - they are text nodes inside label elements
          const labels = document.querySelectorAll('#controls label');
          if (labels && labels.length >= 3) {
            // set the first child text node value for each label
            const setLabelText = (labelEl, text) => {
              for (let i=0;i<labelEl.childNodes.length;i++){
                const n = labelEl.childNodes[i];
                if (n.nodeType === Node.TEXT_NODE) { n.nodeValue = text + ' '; break; }
              }
            };
            setLabelText(labels[0], t.a_label);
            setLabelText(labels[1], t.e_label);
            setLabelText(labels[2], t.i_label);
          }
          // Back button
          const backBtn = document.querySelector('.back-btn button'); if (backBtn) backBtn.textContent = t.back;
          // Informational header and paragraph
          const recH2 = document.querySelector('.recommendation-section h2'); if (recH2) recH2.textContent = t.recommendation_h2;
          const recP = document.querySelector('.recommendation-section p'); if (recP) recP.textContent = t.recommendation_p;
          const paramsH1 = document.querySelector('.recommendation-section h1'); if (paramsH1) paramsH1.textContent = t.params_h1;
          // Table headers
          const ths = document.querySelectorAll('.asteroid-table thead th');
          if (ths && ths.length >= t.table.length) {
            for (let i=0;i<t.table.length;i++) ths[i].textContent = t.table[i];
          }
          // NASA criteria text
          const nasaP = document.querySelector('.nasa-criteria p'); if (nasaP) nasaP.innerHTML = t.nasa_criteria_p;
          // Formulas heading
          const formH2 = document.querySelector('.formulas h2'); if (formH2) formH2.textContent = t.formulas_h2;
          // Formula group titles
          const formulaTitles = document.querySelectorAll('.formula-title');
          if (formulaTitles && formulaTitles.length >= 3) {
            formulaTitles[0].textContent = t.formula_kepler;
            formulaTitles[1].textContent = t.formula_velocity;
            formulaTitles[2].textContent = t.formula_distance;
          }
        }

        const initial = localStorage.getItem('mateoritos_lang') || 'es';
        applyLang(initial);

        // Listen for changes in localStorage from other tabs/windows
        window.addEventListener('storage', (ev) => {
          if (ev.key === 'mateoritos_lang') applyLang(ev.newValue || 'es');
        });
      })();
    </script>
  <!-- Long informational section copied from new/index_new2.html -->
  <div class="space-page-content">
    
  <header class="recommendation-section">
    <h2>RecomendaciÃ³n:</h2>
    <p>Simule la trayectoria de los asteroides a continuaciÃ³n para visualizar su trayectoria.</p>
    <h1>ParÃ¡metros de asteroides PHA de la NASA</h1>
  </header>

  <div class="asteroid-table-container">
    <table class="asteroid-table">
      <thead>
        <tr>
          <th>Asteroide</th>
          <th>H=Brillo</th>
          <th>a=Semieje Mayor (UA)</th>
          <th>q=Perihelio (UA)</th>
          <th>Q=Afelio (UA)</th>
          <th>e=Excentricidad</th>
          <th>i=InclinaciÃ³n Orbital con respecto a la eclÃ­ptica ($^{\circ}$)</th>
          <th>moid=Distancia MÃ­nima de IntersecciÃ³n Orbital con la Tierra (UA)</th>
          <th>PerÃ­odo (aÃ±os)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1862 Apolo (1932 HA)</td>
          <td>16,08</td>
          <td>1,471</td>
          <td>0,647</td>
          <td>2,29</td>
          <td>0,5599</td>
          <td>6,35</td>
          <td>0,026</td>
          <td>1,78</td>
        </tr>
        <tr>
          <td>826663 (2021 PT)</td>
          <td>21,87</td>
          <td>1,22</td>
          <td>0,924</td>
          <td>1,53</td>
          <td>0,2461</td>
          <td>10,15</td>
          <td>0,00429</td>
          <td>1,36</td>
        </tr>
        <tr>
          <td>75632 (2019 ANS)</td>
          <td>21,08</td>
          <td>1,608</td>
          <td>0,942</td>
          <td>2,27</td>
          <td>0,414</td>
          <td>2,02</td>
          <td>0,0258</td>
          <td>2,04</td>
        </tr>
        <tr>
          <td>99942 Apophis</td>
          <td>19,09</td>
          <td>0,9225</td>
          <td>0,7461</td>
          <td>1,099</td>
          <td>0,1912</td>
          <td>3,34</td>
          <td>0,00032</td>
          <td>0,8861</td>
        </tr>
      </tbody>
    </table>
  </div>

  <section class="nasa-criteria">
    <p>La NASA considera como asteroides <strong>PHA (Potencialmente Hazardous Asteroids)</strong> cuando cumplen:</p>
    <ol>
      <li>$H \le 22$</li>
      <li>$\text{Moid} < 0.05 \text{AU}$</li>
    </ol>
  </section>

  <section class="formulas">
    <h2>FÃ³rmulas que determinan los parÃ¡metros mencionados:</h2>
        
    <div class="formula-group">
      <span class="formula-title">Kepler</span>
      <div class="formula-math">
        <span class="mu-notation">&mu; = GM</span> 
        = 
        <span class="fraction-display">
          <span class="numerator">4&middot;&pi;<sup>2</sup> &middot; a<sup>3</sup></span>
          <span class="denominator">T<sup>2</sup></span>
        </span>
        <span class="formula-note">Con a [Km] y T [s]</span>
      </div>
    </div>

    <div class="formula-group">
      <span class="formula-title">Velocidad del asteroide</span>
      <div class="formula-math">
        <span class="v-notation">v</span>
        = 
        <span class="sqrt-display">&radic;</span>
        <span class="sqrt-content">
          <span class="mu-notation">&mu;</span> 
          <span class="parentheses">(</span>
            <span class="fraction-display small-fraction">
              <span class="numerator">2</span>
              <span class="denominator">r</span>
            </span>
            -
            <span class="fraction-display small-fraction">
              <span class="numerator">1</span>
              <span class="denominator">a</span>
            </span>
          <span class="parentheses">)</span>
        </span>
      </div>
    </div>

    <div class="formula-group">
      <span class="formula-title">Distancia con el planeta Tierra</span>
      <div class="formula-math">
        <span class="moid-notation">Moid</span>
        = 
        <span class="min-notation">min</span><sub>&mu;, &nu;</sub>
        <span>||<span class="vector-r">r</span><sub>1</sub>(<span class="vector-r">v</span>) - <span class="vector-r">r</span><sub>2</sub>(<span class="vector-r">v</span>)||</span>
      </div>
    </div>
  </section>

  <footer class="footer-note">
    <p>NASA SPACE APPS CHALLENGE 2025 - SAN LUIS, ARGENTINA</p>
  </footer>
    
</div>
  </body>
</html>